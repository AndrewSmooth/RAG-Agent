{
  "question": "Проанализируй показатели контроля качества за последний квартал по всем производственным линиям, включая количество дефектов, процент брака и основные категории дефектов",
  "sql": "SELECT pl.name as production_line, COUNT(qc.id) as total_inspections, COUNT(CASE WHEN qc.result = 'failed' THEN 1 END) as failed_inspections, ROUND(COUNT(CASE WHEN qc.result = 'failed' THEN 1 END) * 100.0 / COUNT(qc.id), 2) as defect_rate_percent, GROUP_CONCAT(DISTINCT dc.name ORDER BY dc.name SEPARATOR ', ') as defect_categories, GROUP_CONCAT(CASE WHEN qc.result = 'failed' THEN CONCAT(dc.name, ': ', qc.defect_description) END ORDER BY qc.created_at SEPARATOR '; ') as defect_details FROM production_lines pl JOIN work_orders wo ON pl.id = wo.production_line_id JOIN quality_checks qc ON wo.id = qc.work_order_id JOIN defect_categories dc ON qc.defect_category_id = dc.id WHERE qc.created_at >= DATE_SUB(CURDATE(), INTERVAL 3 MONTH) GROUP BY pl.id, pl.name ORDER BY defect_rate_percent DESC;"
}