# Процесс планирования потребности в материалах (MRP)

## Определение
Планирование потребности в материалах (Material Requirements Planning, MRP) — это метод управления производственными запасами, который используется для планирования графика закупок сырья и компонентов. MRP определяет, какие материалы необходимы, в каком количестве и когда они понадобятся для выполнения производственных заказов.

## Цели MRP
- Обеспечить наличие необходимых материалов в нужное время
- Минимизировать уровень запасов и связанные с ними затраты
- Планировать производственные и закупочные операции
- Управлять зависимостями между компонентами
- Обеспечивать своевременное выполнение заказов

## Входные данные для MRP
MRP-система использует три основных источника информации:

### 1. Главный производственный план (MPS)
- Определяет, что и в каком количестве нужно произвести
- Основан на прогнозах спроса и заказах клиентов
- Содержит временные рамки производства

### 2. Спецификация материала (BOM)
- Определяет состав каждого продукта
- Показывает иерархию компонентов и их количество
- Используется для "взлома" продукта на составляющие компоненты

### 3. Информация о запасах
- Текущий уровень запасов каждого материала
- Запланированные поставки (заказы, находящиеся в пути)
- Минимальные и максимальные уровни запасов
- Точки перезаказа

## Процесс расчета MRP
1. **Определение валовых потребностей**
   - На основе MPS определяется, сколько готовой продукции нужно произвести
   - Для каждого продукта "взламывается" BOM, чтобы определить потребность во всех компонентах

2. **Расчет чистых потребностей**
   ```
   Чистая потребность = Валовая потребность - Наличные запасы - Запланированные поставки + Страховой запас
   ```

3. **Планирование заказов**
   - Определяется, когда нужно разместить заказ, учитывая время поставки
   - Рассчитывается размер заказа (по методу EOQ, фиксированный размер и т.д.)

4. **Генерация заказов**
   - Создаются заказы на производство для внутренних компонентов
   - Создаются заказы на закупку для внешних компонентов

## Пример расчета
Допустим, нужно произвести 100 единиц продукта А:
- Продукт А состоит из: 2 единицы компонента B и 3 единицы компонента C
- Текущие запасы: B = 50 единиц, C = 80 единиц
- Страховой запас: B = 10 единиц, C = 20 единиц

1. **Валовая потребность**:
   - Компонент B: 100 × 2 = 200 единиц
   - Комонент C: 100 × 3 = 300 единиц

2. **Чистая потребность**:
   - Компонент B: 200 - 50 + 10 = 160 единиц
   - Компонент C: 300 - 80 + 20 = 240 единиц

3. **Планирование заказов**:
   - Заказ на 160 единиц компонента B с учетом времени поставки
   - Заказ на 240 единиц компонента C с учетом времени поставки

## Применение в системе
В нашей ERP-системе процесс MRP автоматизирован и использует данные из следующих таблиц:
- [`production_order`](rag/knowledge_base/docs/production_order.md:1) - для определения потребности в готовой продукции
- [`bom`](rag/knowledge_base/docs/bom.md:1) и [`bom_component`](rag/knowledge_base/docs/bom_component.md:1) - для определения состава продукции
- [`inventory`](rag/knowledge_base/docs/inventory.md:1) - для учета текущих запасов (предполагаемая таблица)
- [`purchase_order`](rag/knowledge_base/docs/purchase_order.md:1) - для учета запланированных поставок (предполагаемая таблица)

MRP-процесс запускается ежедневно в 02:00 и генерирует:
- Новые производственные заказы для внутренних компонентов
- Новые заказы на закупку для внешних компонентов
- Рекомендации по корректировке существующих заказов

## Преимущества MRP
- Снижение уровня запасов на 20-40%
- Повышение уровня обслуживания клиентов
- Сокращение времени простоя оборудования
- Улучшение планирования производства
- Снижение административных затрат

## Ограничения MRP
- Зависит от точности входных данных
- Не учитывает производственные мощности (решается с помощью MRPII)
- Требует регулярного обновления данных
- Сложность в условиях высокой изменчивости спроса