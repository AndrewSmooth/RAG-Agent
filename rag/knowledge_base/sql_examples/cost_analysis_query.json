{
  "question": "Выполни анализ себестоимости продукции по всем категориям товаров за последний год, включая прямые затраты на материалы, прямые затраты на труд и накладные расходы",
  "sql": "SELECT pc.name as product_category, p.name as product, SUM(bo.quantity * b.material_cost_per_unit) as total_material_cost, SUM(bo.quantity * b.labor_cost_per_unit) as total_labor_cost, SUM(bo.quantity * b.overhead_cost_per_unit) as total_overhead_cost, SUM(bo.quantity * (b.material_cost_per_unit + b.labor_cost_per_unit + b.overhead_cost_per_unit)) as total_production_cost, AVG(b.material_cost_per_unit + b.labor_cost_per_unit + b.overhead_cost_per_unit) as avg_cost_per_unit, p.selling_price, ROUND(p.selling_price - AVG(b.material_cost_per_unit + b.labor_cost_per_unit + b.overhead_cost_per_unit), 2) as gross_profit_per_unit FROM product_categories pc JOIN products p ON pc.id = p.category_id JOIN bill_of_materials b ON p.id = b.product_id JOIN production_orders bo ON p.id = bo.product_id WHERE bo.planned_start_date >= DATE_SUB(CURDATE(), INTERVAL 1 YEAR) GROUP BY pc.id, pc.name, p.id, p.name, p.selling_price ORDER BY pc.name, total_production_cost DESC;"
}