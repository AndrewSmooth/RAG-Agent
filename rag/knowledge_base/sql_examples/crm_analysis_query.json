{
  "question": "Выполни анализ эффективности CRM-процессов: оцени среднее время прохождения сделки по воронке, конверсию на каждой стадии, эффективность менеджеров и прибыльность каналов привлечения",
  "sql": "SELECT s.sales_rep_id, sr.name as sales_representative, m.channel_name as acquisition_channel, COUNT(DISTINCT l.id) as leads_count, COUNT(DISTINCT CASE WHEN l.stage = 'qualified' THEN l.id END) as qualified_leads, ROUND(COUNT(DISTINCT CASE WHEN l.stage = 'qualified' THEN l.id END) * 100.0 / COUNT(DISTINCT l.id), 2) as qualification_rate_percent, COUNT(DISTINCT o.id) as closed_deals, AVG(DATEDIFF(CURDATE(), l.created_date)) as avg_lead_age_days, AVG(DATEDIFF(o.created_date, l.created_date)) as avg_sales_cycle_duration_days, SUM(CASE WHEN o.id IS NOT NULL THEN 1 ELSE 0 END) * 100.0 / COUNT(DISTINCT l.id) as overall_conversion_rate_percent, SUM(o.value) as total_revenue, AVG(o.value) as average_deal_size, SUM(o.gross_profit) as total_gross_profit FROM leads l JOIN sales_representatives sr ON l.assigned_to = sr.id JOIN marketing_channels m ON l.source_channel_id = m.id LEFT JOIN orders o ON l.id = o.lead_id WHERE l.created_date >= DATE_SUB(CURDATE(), INTERVAL 6 MONTH) GROUP BY s.sales_rep_id, sr.name, m.channel_name ORDER BY total_revenue DESC;"
}