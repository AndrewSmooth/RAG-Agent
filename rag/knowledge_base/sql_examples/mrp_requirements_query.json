{
  "question": "Сформируй отчет MRP по всем компонентам, необходимым для производства продукции в следующем квартале, включая текущие запасы, запланированные поставки и дефицит",
  "sql": "SELECT c.name as component, c.unit_of_measure, SUM(bo.quantity * b.quantity) as total_required, i.quantity_on_hand as current_inventory, COALESCE(SUM(ps.quantity), 0) as scheduled_receipts, (SUM(bo.quantity * b.quantity) - i.quantity_on_hand - COALESCE(SUM(ps.quantity), 0)) as net_requirement, CASE WHEN (SUM(bo.quantity * b.quantity) - i.quantity_on_hand - COALESCE(SUM(ps.quantity), 0)) > 0 THEN 'Order' ELSE 'OK' END as action FROM components c JOIN bill_of_materials b ON c.id = b.component_id JOIN production_orders bo ON b.product_id = bo.product_id JOIN inventory i ON c.id = i.component_id LEFT JOIN purchase_orders ps ON c.id = ps.component_id AND ps.status = 'confirmed' AND ps.expected_delivery_date BETWEEN CURDATE() AND DATE_ADD(CURDATE(), INTERVAL 3 MONTH) WHERE bo.planned_start_date BETWEEN CURDATE() AND DATE_ADD(CURDATE(), INTERVAL 3 MONTH) GROUP BY c.id, c.name, c.unit_of_measure, i.quantity_on_hand ORDER BY net_requirement DESC;"
}